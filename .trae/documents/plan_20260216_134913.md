I have analyzed the codebase and the new requirements. Here is the comprehensive plan to implement the "Extended Player Arsenal" and "Ultimate Boss Fight".

### 1. Core Systems & Constants
*   **Update `constants.py`**: Define new damage values, card costs, timing windows (e.g., `PERFECT_PARRY_WINDOW = 5`), and physics constants (e.g., `SUPER_DASH_SPEED`).

### 2. Player Arsenal (`player.py`)
#### A. Movement System
*   **Triple Jump**: Add logic for `Air-Jump` (with 45° directional control) and `Parry-Jump` (150% height boost).
*   **Super Dash**: Implement `is_super_dash` state costing 1 card.
    *   **Features**: Double distance, extended i-frames, trail effect, knockback on enemies.
*   **Slam Down**: Refine `[Down + Dash]` behavior for rapid descent.
*   **Wall Mechanics**: Implement "Momentum Chain" logic (speed boost on perfect wall jumps).

#### B. Offensive System
*   **Charge Shot**: Update `shoot_charge` to fire `MegaPaperBall` (3x damage, piercing, large hitbox).
*   **New Weapons**:
    *   **Spread Shot** (2 Cards): Fires 5 projectiles in a 45° arc.
    *   **Homing Shot** (3 Cards): Fires 3 projectiles that target boss weak points.
*   **EX Attacks**:
    *   **EX-Eraser**: Implement explosion logic (100px radius) on impact.
    *   **EX-Ruler**: Refine boomerang logic to ensure "catch" mechanic works for card refund.
    *   **EX-Super**: Ensure full-screen laser effect and correct damage tick rate (1.5/frame).

#### C. Defense & Parry
*   **Perfect Parry**:
    *   Tighten window to 5 frames.
    *   Rewards: 2 Cards, Bullet-Time (0.3s), Triple Jump unlock.
*   **Parry Counter**: Implement "Hot Window" (1s) where shots are Golden (2x damage).
*   **Streber Mode**: Track 3-chain parries to trigger 10s of Golden shots.
*   **Notizbuch Shield**: Add `activate_shield` visual (0.5s deploy) and block logic.

### 3. Boss Fight: Dr. Pythagoras 2.0 (`boss.py` & `boss_projectiles.py`)
#### A. General Boss Logic
*   **Weak Point System**: Add temporary hitboxes (Hand, Center, Head) that take 2x-4x damage.
*   **Teleport System**: Implement unpredictable teleportation with telegraphing.

#### B. Phase 1: "The Lesson" (100-70 HP)
*   **Geometry Attack**: Add "Advanced" variation (Spread pattern with pink projectile).
*   **Eraser Attack**: Add "Chaos Mode" (2 erasers, different speeds).
*   **Chalkboard Wipe**: Implement slow-moving wall with pink core.

#### C. Phase 2: "Reality Check" (70-30 HP)
*   **Protractor Spin**: Create rotating hazard around boss; pink tip variant triggers stun.
*   **Textbook Slam**: Implement giant shadow telegraph and slam attack; "Brave Bonus" check.
*   **Equation Rain**: Update to wave-based spawn pattern.

#### D. Phase 3: "Despair" (30-0 HP)
*   **Compass Hell**: Upgrade to 16-way and rotating bursts.
*   **Pointer of Death**: Add "Sweeping Laser" mechanic.
*   **Blackboard Barrage**: Implement the "Ultimate" attack combining multiple hazards.
*   **Reality Break**: Implement screen effects for Control Invert, Gravity Invert, and Slow-Mo.

### 4. Game Feel & Visuals (`effects.py` & `projectiles.py`)
*   **Juice**: Add screen shake types (Impact, Directional, Rumble).
*   **Particles**: Implement specific particles for dashes, hits, and parries.
*   **Feedback**: Add damage numbers (White/Yellow/Red) and "Freeze Frame" on perfect parries.

I will start by updating the **Player Movement and Offensive Systems** to give you the tools to fight, and then move on to the **Boss AI and Attack Patterns**.